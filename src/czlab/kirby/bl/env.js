/*Auto generated by Kirby - v1.0.0 czlab.kirby.bl.env Wed Nov 01 2017 02:54:41 GMT-0700 (PDT)*/

var std = require("./stdlib");
var types = require("./types");
var Symbol = types["Symbol"];


class LEXEnv {
  constructor(parent, vars, exprs) {
    this.parent = std.maybe(parent, null);
    this.data = {};
    (
    (vars && exprs) ?
      (function() {
        return (function() {
          for (let i = 0, e = null, ev = null, ____break = false; ((!____break) && (i < vars.length)); i = (i + 1)) {
            e = vars[i];
            ev = e.value;
            (
            (ev === "&") ?
              (function() {
                this.data[vars[(i + 1)].value] = Array.prototype.slice.call(exprs, i);
                return ____break = true;
              }).call(this) :
              (e.startsWith("&") ?
                (function() {
                  this.data[e.slice(1)] = Array.prototype.slice.call(exprs, i);
                  return ____break = true;
                }).call(this) :
                (true ?
                  this.data[e] = exprs[i] :
                  null)));
          }
        })(this);

      }).call(this) :
      null);
    return this;
  }

  find(key) {
    (
    (!(key instanceof Symbol)) ?
      (function() {
        throw new Error("env.xxx key must be a symbol");
      }).call(this) :
      null);
    return (std.contains_QUERY(this.data, key.value) ?
      this :
      (std.some_QUERY(this.parent) ?
        this.parent.find(key) :
        null));
  }

  set(key, value) {
    (
    (!(key instanceof Symbol)) ?
      (function() {
        throw new Error("env.xxx key must be a symbol");
      }).call(this) :
      null);
    this.data[key.value] = value;
    return value;
  }

  get(key) {
    (
    (!(key instanceof Symbol)) ?
      (function() {
        throw new Error("env.xxx key must be a symbol");
      }).call(this) :
      null);
    let env;
    env = this.find(key);

    (
    (!env) ?
      (function() {
        throw new Error([key.value, " not found"].join(""));
      }).call(this) :
      null);
    return env.data[key.value];
  }

}

